{
  "admin_email": "${ADMIN_EMAIL}",
  "_comment_smtp": "Configurazione per il server SMTP per l'invio di notifiche email.",
  "smtp": {
    "host": "${SMTP_HOST}",
    "port": "${SMTP_PORT}",
    "username": "${SMTP_USERNAME}",
    "password": "${SMTP_PASSWORD}"
  },
  "workflows": [
    {
      "id": "sdi-zap",
      "_comment_trigger": "Questo trigger controlla la casella Gmail a intervalli regolari.",
      "trigger": {
        "type": "gmail_poll",
        "max_results": 10,
        "interval": 60,
		"accounts": [
		  {"token_file": "token_aziendaagricolapezzuoli.json", "query": "from:notifiche@01s.eu label:inbox -is:starred"}
		]
      },
      "actions": [
        {
          "type": "gmail_archive",
          "params": {
			    "local_dir": "../gmail/archive",
			    "attachment_types": [".pdf"],
			    "save_message": true,
			    "save_attachments": true,
			    "download_links": true
			}
        },
        {
			    "type": "excel_append", 
			    "params": {
				 "file": "../gmail/log.xlsm", 
				"datetime": "DD/MM/YYYY  HH:MM:SS",
				"max_message_length": 1000
				}
		},
        {
          "type": "pdf_split",
          "params": {
            "output_dir": "../fatture/split",
            "pattern": "Cedente/prestatore \\(fornitore\\)",
			"parse_invoice": true,
            "name_template": "{data_documento} Fattura {numero_documento} {denominazione}.pdf",
            "regex_fields": {
			  "_comment_0": "Limita la ricerca al primo nl e limita il numero massimo di parole a 3",
              "denominazione": "Denominazione:\\s*((?:\\S+\\s+){0,1}\\S+)"
            },
			"table_fields": [
			  {"header": "Tipologia documento", "key": "tipologia", "tokens": 2},
			  {"header": "Art. 73", "key": "art_73", "tokens": 0},
			  {"header": "Numero documento", "key": "numero_documento", "tokens": 2},
			  {"header": "Data documento", "key": "data_documento"},
			  {"header": "Codice destinatario", "key": "dest"}
			]
          }
        }
      ]
    }
  ]
}
